<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simple Interest Quiz</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
</head>
<body class="bg-light" id="mainBody">
    <div class="container py-5">
        <div class="row justify-content-center">
            <div class="col-lg-8">
                <!-- Header -->
                <div class="card shadow-sm mb-4 border-0">
                    <div class="card-body text-center py-4">
                        <h1 class="display-5 fw-bold mb-3 text-dark">Simple Interest Quiz</h1>
                        <p class="lead text-muted mb-3">Test Your Knowledge - <span id="totalQuestions">40</span> Questions</p>
                        <div class="d-flex justify-content-center gap-3 flex-wrap">
                            <button class="btn btn-outline-dark" id="themeToggleBtn" onclick="toggleTheme()">
                                <i class="bi bi-moon-fill me-2"></i>Toggle Theme
                            </button>
                            <span class="badge bg-dark fs-6 px-4 py-2" id="scoreBadge">Score: <span id="score">0</span>/<span id="totalScore">40</span></span>
                        </div>
                    </div>
                </div>

                <!-- Formula Card -->
                <div class="card shadow-sm mb-4 border-0" id="formulaCard">
                    <div class="card-body bg-dark text-white">
                        <h5 class="mb-3"><i class="bi bi-calculator me-2"></i>Key Formula</h5>
                        <p class="mb-2 fs-5"><strong>SI = (P × N × R) / 100</strong></p>
                        <small>SI = Simple Interest | P = Principal | N = Time | R = Rate</small>
                    </div>
                </div>

                <!-- Questions -->
                <div id="questionsContainer"></div>

                <!-- Pagination -->
                <div class="d-flex justify-content-center gap-2 mt-4" id="paginationContainer"></div>

                <!-- Result Summary -->
                <div class="card shadow-sm border-0 mt-4">
                    <div class="card-body text-center">
                        <h4 class="mb-3 text-dark">Quiz Summary</h4>
                        <p class="lead">Your Score: <span id="finalScore" class="fw-bold text-dark">0</span>/<span id="finalTotalScore">40</span></p>
                        <button class="btn btn-outline-dark" id="resetQuizBtn" onclick="resetQuiz()">
                            <i class="bi bi-arrow-clockwise me-2"></i>Reset Quiz
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        let questions = [];
        let score = 0;
        let answered = [];
        let selectedOptions = [];
        let currentPage = 1;
        const questionsPerPage = 10;

        async function loadQuestions() {
            try {
                const response = await fetch('questions.json');
                questions = await response.json();
                answered = new Array(questions.length).fill(false);
                selectedOptions = new Array(questions.length).fill(-1);
                document.getElementById('totalQuestions').textContent = questions.length;
                document.getElementById('totalScore').textContent = questions.length;
                document.getElementById('finalTotalScore').textContent = questions.length;
                createQuestions();
            } catch (error) {
                console.error('Error loading questions:', error);
                document.getElementById('questionsContainer').innerHTML = '<p class="text-danger">Failed to load questions. Please try again later.</p>';
            }
        }

        function typeWriter(element, text, speed, callback) {
            let i = 0;
            element.innerHTML = '';
            
            function type() {
                if (i < text.length) {
                    element.innerHTML += text.charAt(i);
                    i++;
                    setTimeout(type, speed);
                } else if (callback) {
                    callback();
                }
            }
            type();
        }

        function animateOptions(questionIndex) {
            const options = document.querySelectorAll(`#question-${questionIndex} .option-btn`);
            options.forEach((option, index) => {
                setTimeout(() => {
                    option.classList.add('show-option');
                }, index * 200);
            });
        }

        function createQuestions() {
            const container = document.getElementById('questionsContainer');
            const isDarkTheme = document.getElementById('mainBody').classList.contains('bg-dark');
            container.innerHTML = '';

            const startIndex = (currentPage - 1) * questionsPerPage;
            const endIndex = Math.min(startIndex + questionsPerPage, questions.length);
            const currentQuestions = questions.slice(startIndex, endIndex);

            currentQuestions.forEach((q, index) => {
                const globalIndex = startIndex + index;
                const card = document.createElement('div');
                card.className = 'card shadow-sm mb-4 border-0' + (isDarkTheme ? ' bg-dark text-white border border-light' : '');
                card.id = `question-${globalIndex}`;
                
                const optionsHTML = q.options.map((opt, optIndex) => `
                    <div class="mb-2">
                        <button class="btn ${isDarkTheme ? 'btn-outline-light' : 'btn-outline-dark'} text-start option-btn" 
                                onclick="selectOption(${globalIndex}, ${optIndex})"
                                id="option-${globalIndex}-${optIndex}"
                                ${answered[globalIndex] ? 'disabled' : ''}>
                            <span class="me-2">${String.fromCharCode(65 + optIndex)}.</span>${opt}
                            <span class="float-end" id="icon-${globalIndex}-${optIndex}"></span>
                        </button>
                    </div>
                `).join('');

                card.innerHTML = `
                    <div class="card-body">
                        <h5 class="card-title mb-3 ${isDarkTheme ? 'text-white' : 'text-dark'}">
                            <span class="badge ${isDarkTheme ? 'bg-secondary text-white' : 'bg-dark text-white'} me-2">${globalIndex + 1}</span>
                            <span id="question-text-${globalIndex}"></span>
                        </h5>
                        <div class="mb-3">${optionsHTML}</div>
                        <button class="btn ${isDarkTheme ? 'btn-outline-light' : 'btn-outline-dark'}" 
                                onclick="checkAnswer(${globalIndex})" 
                                id="check-btn-${globalIndex}"
                                ${answered[globalIndex] ? 'disabled' : ''}>
                            <i class="bi bi-check-circle me-2"></i>Check Answer
                        </button>
                        <div class="alert ${isDarkTheme ? 'alert-secondary' : 'alert-dark'} mt-3" 
                             id="explanation-${globalIndex}" 
                             style="display: ${answered[globalIndex] ? 'block' : 'none'};">
                            <strong><i class="bi bi-lightbulb me-2"></i>Explanation:</strong>
                            <p class="mb-0 mt-2">${q.explanation}</p>
                        </div>
                    </div>
                `;
                
                container.appendChild(card);

                // Restore previous selections and states
                if (selectedOptions[globalIndex] !== -1) {
                    const selectedBtn = document.getElementById(`option-${globalIndex}-${selectedOptions[globalIndex]}`);
                    selectedBtn.classList.add('active', 'btn-dark');
                    selectedBtn.classList.remove(isDarkTheme ? 'btn-outline-light' : 'btn-outline-dark');
                }
                if (answered[globalIndex]) {
                    const correctIndex = questions[globalIndex].correct;
                    for (let i = 0; i < 4; i++) {
                        const btn = document.getElementById(`option-${globalIndex}-${i}`);
                        const icon = document.getElementById(`icon-${globalIndex}-${i}`);
                        if (i === correctIndex) {
                            btn.classList.remove('btn-outline-dark', 'btn-outline-light', 'btn-dark');
                            btn.classList.add('btn-success');
                            icon.innerHTML = '<i class="bi bi-check-circle-fill text-white"></i>';
                        } else if (i === selectedOptions[globalIndex] && selectedOptions[globalIndex] !== correctIndex) {
                            btn.classList.remove('btn-outline-dark', 'btn-outline-light', 'btn-dark');
                            btn.classList.add('btn-danger');
                            icon.innerHTML = '<i class="bi bi-x-circle-fill text-white"></i>';
                        }
                    }
                }

                const observer = new IntersectionObserver((entries) => {
                    entries.forEach(entry => {
                        if (entry.isIntersecting) {
                            const questionText = entry.target.querySelector(`#question-text-${globalIndex}`);
                            typeWriter(questionText, q.q, 15, () => {
                                animateOptions(globalIndex);
                            });
                            observer.unobserve(entry.target);
                        }
                    });
                }, { threshold: 0.3 });

                observer.observe(card);
            });

            createPagination();
        }

        function createPagination() {
            const container = document.getElementById('paginationContainer');
            container.innerHTML = '';
            const totalPages = Math.ceil(questions.length / questionsPerPage);
            const isDarkTheme = document.getElementById('mainBody').classList.contains('bg-dark');

            const nav = document.createElement('nav');
            nav.setAttribute('aria-label', 'Page navigation');
            const ul = document.createElement('ul');
            ul.className = 'pagination';

            // Previous Button
            const prevLi = document.createElement('li');
            prevLi.className = 'page-item' + (currentPage === 1 ? ' disabled' : '');
            const prevLink = document.createElement('a');
            prevLink.className = 'page-link';
            prevLink.href = '#';
            prevLink.innerText = 'Previous';
            prevLink.onclick = () => changePage(currentPage - 1);
            prevLi.appendChild(prevLink);
            ul.appendChild(prevLi);

            // Page Number Buttons
            for (let i = 1; i <= totalPages; i++) {
                const li = document.createElement('li');
                li.className = 'page-item' + (i === currentPage ? ' active' : '');
                const link = document.createElement('a');
                link.className = 'page-link';
                link.href = '#';
                link.innerText = i;
                link.onclick = () => changePage(i);
                li.appendChild(link);
                ul.appendChild(li);
            }

            // Next Button
            const nextLi = document.createElement('li');
            nextLi.className = 'page-item' + (currentPage === totalPages ? ' disabled' : '');
            const nextLink = document.createElement('a');
            nextLink.className = 'page-link';
            nextLink.href = '#';
            nextLink.innerText = 'Next';
            nextLink.onclick = () => changePage(currentPage + 1);
            nextLi.appendChild(nextLink);
            ul.appendChild(nextLi);

            nav.appendChild(ul);
            container.appendChild(nav);
        }

        function changePage(page) {
            const totalPages = Math.ceil(questions.length / questionsPerPage);
            if (page < 1 || page > totalPages) return;
            currentPage = page;
            createQuestions();
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function selectOption(questionIndex, optionIndex) {
            if (answered[questionIndex]) return;

            // Reset all buttons and icons
            for (let i = 0; i < 4; i++) {
                const btn = document.getElementById(`option-${questionIndex}-${i}`);
                const isDarkTheme = document.getElementById('mainBody').classList.contains('bg-dark');
                btn.classList.remove('active', 'btn-dark', 'btn-success', 'btn-danger', 'btn-outline-dark', 'btn-outline-light');
                btn.classList.add(isDarkTheme ? 'btn-outline-light' : 'btn-outline-dark');
                const icon = document.getElementById(`icon-${questionIndex}-${i}`);
                icon.innerHTML = '';
            }

            // Highlight selected option
            const selectedBtn = document.getElementById(`option-${questionIndex}-${optionIndex}`);
            selectedBtn.classList.add('active', 'btn-dark');
            selectedBtn.classList.remove('btn-outline-dark', 'btn-outline-light');
            selectedOptions[questionIndex] = optionIndex;

            // Show green tick for correct option immediately
            const correctIndex = questions[questionIndex].correct;
            const correctBtn = document.getElementById(`option-${questionIndex}-${correctIndex}`);
            const correctIcon = document.getElementById(`icon-${questionIndex}-${correctIndex}`);
            correctBtn.classList.remove('btn-outline-dark', 'btn-outline-light', 'btn-dark');
            correctBtn.classList.add('btn-success');
            correctIcon.innerHTML = '<i class="bi bi-check-circle-fill text-white"></i>';
        }

        function checkAnswer(questionIndex) {
            if (answered[questionIndex]) return;

            const selectedIndex = selectedOptions[questionIndex];
            const correctIndex = questions[questionIndex].correct;

            answered[questionIndex] = true;

            for (let i = 0; i < 4; i++) {
                const btn = document.getElementById(`option-${questionIndex}-${i}`);
                btn.disabled = true;
                const icon = document.getElementById(`icon-${questionIndex}-${i}`);
                
                if (i === correctIndex) {
                    btn.classList.remove('btn-outline-dark', 'btn-outline-light', 'btn-dark');
                    btn.classList.add('btn-success');
                    icon.innerHTML = '<i class="bi bi-check-circle-fill text-white"></i>';
                } else if (i === selectedIndex && selectedIndex !== -1 && selectedIndex !== correctIndex) {
                    btn.classList.remove('btn-outline-dark', 'btn-outline-light', 'btn-dark');
                    btn.classList.add('btn-danger');
                    icon.innerHTML = '<i class="bi bi-x-circle-fill text-white"></i>';
                }
            }

            document.getElementById(`explanation-${questionIndex}`).style.display = 'block';

            if (selectedIndex === correctIndex && selectedIndex !== -1) {
                score++;
                document.getElementById('score').textContent = score;
                document.getElementById('finalScore').textContent = score;
            }

            document.getElementById(`check-btn-${questionIndex}`).disabled = true;
        }

        function toggleTheme() {
            const body = document.getElementById('mainBody');
            const cards = document.querySelectorAll('.card');
            const formulaCard = document.getElementById('formulaCard');
            const scoreBadge = document.getElementById('scoreBadge');
            const style = document.createElement('style');
            
            if (body.classList.contains('bg-light')) {
                body.classList.remove('bg-light');
                body.classList.add('bg-dark');
                
                // Update text, badge, and button colors
                document.querySelectorAll('.text-dark').forEach(el => {
                    el.classList.remove('text-dark');
                    el.classList.add('text-white');
                });
                document.querySelectorAll('.text-muted').forEach(el => {
                    el.classList.remove('text-muted');
                    el.classList.add('text-light');
                });
                document.querySelectorAll('.badge.bg-dark').forEach(el => {
                    el.classList.remove('bg-dark');
                    el.classList.add('bg-secondary');
                });
                document.querySelectorAll('.btn-outline-dark').forEach(el => {
                    el.classList.remove('btn-outline-dark');
                    el.classList.add('btn-outline-light');
                });
                document.querySelectorAll('.alert-dark').forEach(el => {
                    el.classList.remove('alert-dark');
                    el.classList.add('alert-secondary');
                });
                
                // Ensure formula card remains dark with white text
                formulaCard.querySelector('.card-body').classList.add('bg-dark', 'text-white');
                
                // Add dark theme styles
                style.id = 'darkThemeStyles';
                style.innerHTML = `
                    .bg-dark .card-body {
                        background-color: #343a40 !important;
                        color: #f8f9fa !important;
                    }
                    .bg-dark .option-btn {
                        color: #f8f9fa !important;
                        border-color: #f8f9fa !important;
                        background-color: transparent !important;
                    }
                    .bg-dark .option-btn:hover {
                        background-color: #6c757d !important;
                        color: #f8f9fa !important;
                    }
                    .bg-dark .option-btn.active {
                        background-color: #f8f9fa !important;
                        color: #212529 !important;
                    }
                    .bg-dark .btn-success {
                        background-color: #198754 !important;
                        border-color: #198754 !important;
                        color: #f8f9fa !important;
                    }
                    .bg-dark .btn-danger {
                        background-color: #dc3545 !important;
                        border-color: #dc3545 !important;
                        color: #f8f9fa !important;
                    }
                    .bg-dark .alert-secondary {
                        background-color: #495057 !important;
                        color: #f8f9fa !important;
                    }
                    .bg-dark .badge.bg-secondary {
                        background-color: #6c757d !important;
                        color: #f8f9fa !important;
                    }
                    .bg-dark .page-link {
                        background-color: #343a40 !important;
                        color: #f8f9fa !important;
                        border-color: #f8f9fa !important;
                    }
                    .bg-dark .page-item.active .page-link {
                        background-color: #6c757d !important;
                        color: #f8f9fa !important;
                        border-color: #f8f9fa !important;
                    }
                    .bg-dark .page-item.disabled .page-link {
                        background-color: #343a40 !important;
                        color: #6c757d !important;
                        border-color: #6c757d !important;
                    }
                `;
                document.head.appendChild(style);
                
                cards.forEach(card => {
                    if (!card.id === 'formulaCard' && !card.querySelector('.bg-dark.text-white')) {
                        card.classList.add('bg-dark', 'text-white', 'border', 'border-light');
                    }
                });
            } else {
                body.classList.remove('bg-dark');
                body.classList.add('bg-light');
                
                // Revert text, badge, button, and alert colors
                document.querySelectorAll('.text-white:not(.badge .text-white):not(#formulaCard .text-white)').forEach(el => {
                    el.classList.remove('text-white');
                    el.classList.add('text-dark');
                });
                document.querySelectorAll('.text-light').forEach(el => {
                    el.classList.remove('text-light');
                    el.classList.add('text-muted');
                });
                document.querySelectorAll('.badge.bg-secondary').forEach(el => {
                    el.classList.remove('bg-secondary');
                    el.classList.add('bg-dark');
                });
                document.querySelectorAll('.btn-outline-light').forEach(el => {
                    el.classList.remove('btn-outline-light');
                    el.classList.add('btn-outline-dark');
                });
                document.querySelectorAll('.alert-secondary').forEach(el => {
                    el.classList.remove('alert-secondary');
                    el.classList.add('alert-dark');
                });
                
                // Ensure formula card remains dark with white text
                formulaCard.querySelector('.card-body').classList.add('bg-dark', 'text-white');
                
                // Remove dark theme styles
                const existingStyle = document.getElementById('darkThemeStyles');
                if (existingStyle) {
                    existingStyle.remove();
                }
                
                // Revert card styles
                cards.forEach(card => {
                    if (card.id !== 'formulaCard') {
                        card.classList.remove('bg-dark', 'text-white', 'border', 'border-light');
                    }
                });

                // Reset pagination styles to default
                document.querySelectorAll('.page-link').forEach(link => {
                    link.style.backgroundColor = '';
                    link.style.color = '';
                    link.style.borderColor = '';
                });
                document.querySelectorAll('.page-item.active .page-link').forEach(link => {
                    link.style.backgroundColor = '';
                    link.style.color = '';
                    link.style.borderColor = '';
                });
                document.querySelectorAll('.page-item.disabled .page-link').forEach(link => {
                    link.style.backgroundColor = '';
                    link.style.color = '';
                    link.style.borderColor = '';
                });
            }

            // Refresh questions to apply correct theme styles
            createQuestions();
        }

        function resetQuiz() {
            score = 0;
            answered = new Array(questions.length).fill(false);
            selectedOptions = new Array(questions.length).fill(-1);
            currentPage = 1;
            document.getElementById('score').textContent = '0';
            document.getElementById('finalScore').textContent = '0';
            document.getElementById('questionsContainer').innerHTML = '';
            createQuestions();
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        window.addEventListener('load', loadQuestions);
    </script>
</body>
</html>